import{n as f,s as x,a as z,r as A,i as E}from"./scheduler.CTPOpGXE.js";const c=[];function y(t,i){return{subscribe:m(t,i).subscribe}}function m(t,i=f){let e;const r=new Set;function u(s){if(x(t,s)&&(t=s,e)){const o=!c.length;for(const n of r)n[1](),c.push(n,t);if(o){for(let n=0;n<c.length;n+=2)c[n][0](c[n+1]);c.length=0}}}function l(s){u(s(t))}function d(s,o=f){const n=[s,o];return r.add(n),r.size===1&&(e=i(u,l)||f),s(t),()=>{r.delete(n),r.size===0&&e&&(e(),e=null)}}return{set:u,update:l,subscribe:d}}function q(t,i,e){const r=!Array.isArray(t),u=r?[t]:t;if(!u.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const l=i.length<2;return y(e,(d,s)=>{let o=!1;const n=[];let p=0,h=f;const w=()=>{if(p)return;h();const a=i(r?n[0]:n,d,s);l?d(a):h=E(a)?a:f},g=u.map((a,b)=>z(a,v=>{n[b]=v,p&=~(1<<b),o&&w()},()=>{p|=1<<b}));return o=!0,w(),function(){A(g),h(),o=!1}})}export{q as d,y as r,m as w};
